<div *ngIf="couponPass !== null" class="container-fluid">
  <div class="row">
    <div class="col-md-10 col-12 offset-md-1">
      <div class="card mx-3">
        <div class="card-body p-4">
          <h1 class="text-center">{{fromEdit ? 'Modifica' : 'Crea'}}</h1>
          <h4 class="text-muted text-center">{{fromEdit ? 'Modifica ' : 'Crea '}} Pacchetto</h4>

          <form [formGroup]="couponForm" (ngSubmit)="saveChange()">

            <div class="form-group row">
              <label class="col-sm-2 col-form-label">Titolo</label>
              <div class="col-sm-10">
                <input type="text" formControlName="title" class="form-control"
                       [ngClass]="{ 'is-invalid': submitted && f.title.errors }"/>
                <div *ngIf="submitted && f.title.errors" class="invalid-feedback">
                  <div *ngIf="f.title.errors">Titolo obbligatorio, da 5 a 40 caratteri</div>
                </div>
              </div>
            </div> <!-- Title -->
            <div class="form-group row">
              <label class="col-sm-2 col-form-label">Descrizione:</label>
              <div class="col-sm-10">
                <textarea type="text" formControlName="description" class="form-control"
                          [ngClass]="{ 'is-invalid': submitted && f.description.errors }"></textarea>
                <div *ngIf="submitted && f.description.errors" class="invalid-feedback">
                  <div *ngIf="f.description.errors">Descrizione obbligatoria, deve essere tra 5 e 255 caratteri</div>
                </div>
              </div>
            </div> <!-- Description -->

            <div class="form-group row">
              <label class="col-sm-2 col-form-label">Immagine</label>
              <div class="col-sm-10">
                <div id="yourImage">
                  <img src="{{imageURL}}">
                </div>

                <input  type="file" class="col-sm-6 p-0" formControlName="image" ng2FileSelect [uploader]="uploader"
                       [ngClass]="{ 'is-invalid': submitted && f.image.errors }"/>

                <div *ngFor="let item of uploader.queue" class="col-sm-6 p-0 mr-0 float-right">
                  <div>
                    <button type="button" class="btn btn-success btn-sm ml-1"
                            (click)="item.upload()" [disabled]="item.isReady || item.isUploading || item.isSuccess">
                      <span class="glyphicon glyphicon-upload"></span> Aggiorna
                    </button>
                    <button type="button" class="btn btn-warning btn-sm ml-1"
                            (click)="item.cancel()" [disabled]="!item.isUploading">
                      <span class="glyphicon glyphicon-ban-circle"></span> Annulla
                    </button>
                    <button type="button" class="btn btn-danger btn-sm ml-1"
                            (click)="item.remove()">
                      <span class="glyphicon glyphicon-trash"></span> Rimuovi
                    </button>
                  </div>
                </div>

              <div class="mt-2">
                Attendi:
                <div class="progress" style="width: 75%;">
                  <div class="progress-bar" role="progressbar"
                       [ngStyle]="{ 'width': uploader.progress + '%' }">
                  </div>
                </div>
              </div>

                <div *ngIf="submitted && f.image.errors" class="invalid-feedback">
                  <!--<div *ngIf="f.image.errors">Image is required</div>-->
                  <div>Immagine obbligatoria.</div>
                </div>
              </div>
            </div> <!-- Image -->
            <div class="form-group row">
              <label class="col-sm-2 col-form-label">Prezzo</label>
              <div class="col-sm-8">
                <input [readonly]="markedFree" type="number" formControlName="price" class="form-control"
                       [ngClass]="{ 'is-invalid': submitted && f.price.errors }"/>
                <div *ngIf="submitted && f.price.errors" class="invalid-feedback">
                  <div *ngIf="f.price.errors">Valore obbligatorio</div>
                </div>
              </div>
              <div class="col-sm-2">
                <div class="custom-control custom-checkbox">
                  <input type="checkbox" class="custom-control-input" id="freeCheck"
                         [checked]="markedFree" (change)="toggleCheckbox($event)" data-md-icheck>
                  <label class="custom-control-label" for="freeCheck">Gratis</label>
                </div>
              </div>
            </div> <!-- Price -->

            <div class="form-group row">
              <label class="col-sm-2 col-form-label">Visibile da:</label>
              <div class="col-sm-8">
                <input style="background: white" type="text" mwlFlatpickr
                       [clickOpens]="true" [noCalendar]="false" [convertModelValue]="true" [enableTime]="true"
                       dateFormat="Y-m-d H:i" formControlName="published_from" class="form-control"
                       [style.background]="bgColorPrivate"
                       [ngClass]="{ 'is-invalid': submitted && f.valid_from.errors }"/>
                <div *ngIf="submitted && f.published_from.errors " class="invalid-feedback">
                  <div *ngIf=" f.published_from.errors ">data non corretta</div>
                </div>
              </div>
              <div class="col-sm-2">
                <div class="custom-control custom-checkbox">
                  <input type="checkbox" name="privateCheck" class="custom-control-input" id="privateCheck"
                         [checked]="markedPrivate" (change)="toggleCheckbox($event)"
                         data-md-icheck>
                  <label class="custom-control-label" for="privateCheck">Privato</label>
                </div>
              </div>
            </div> <!-- Published From -->
            <div *ngIf="couponsAvailable" class="form-group row ">
              <label class="col-sm-2 col-form-label">Coupons selezionati: </label>
              <div class="col-sm-12 col-lg-8">
                <ng-select formControlName="coupons"
                           [items]="couponsAvailable"
                           [multiple]="true"
                           [closeOnSelect]="true"
                           [searchable]= "true"
                           bindLabel="title"
                           placeholder="Seleziona coupons"
                           [(ngModel)]="selectedCoupons"
                           [ngClass]="{ 'is-invalid': submitted && f.coupons.errors }" >
                </ng-select>
              </div>

            </div>
            <div  class="form-group row">
              <label class="col-sm-2 col-form-label">Seleziona categorie: </label>
              <div class="col-sm-8">
                <ng-select formControlName="categories"
                           [items]="categories"
                           [multiple]="true"
                           [closeOnSelect]="true"
                           [searchable]= "true"
                           bindLabel="name"
                           placeholder="Seleziona categorie"
                           [(ngModel)]="selectedCategories">
                </ng-select>
              </div>

            </div>
            <div class="form-group row">
              <label class="col-sm-2 col-form-label">Valido da:</label>
              <div class="col-sm-10">
                <input style="background: white" type="text" mwlFlatpickr
                       [clickOpens]="true" [noCalendar]="false" [convertModelValue]="true" [enableTime]="true"
                       dateFormat="Y-m-d H:i" formControlName="valid_from" class="form-control"
                       [ngClass]="{ 'is-invalid': submitted && f.valid_from.errors }"/>
                <div *ngIf="submitted && f.valid_from.errors " class="invalid-feedback">
                  <div *ngIf=" f.valid_from.errors ">Data non corretta</div>
                </div>
              </div>
            </div> <!-- Valid From -->
            <div class="form-group row">
              <label class="col-sm-2 col-form-label">Scadenza:</label>
              <div class="col-sm-8">
                <input type="text"
                       [style.background]="bgColorCalendar"
                       [noCalendar]="false"
                       [convertModelValue]="true"
                       [enableTime]="true"
                       dateFormat="Y-m-d H:i" formControlName="valid_until" class="form-control"
                       [ngClass]="{ 'is-invalid':  submitted && f.valid_until.errors?.MatchDateFromUntil }"
                       mwlFlatpickr/>
                <!--[ngStyle]="{'background': markedUnlimited ? '#e4e7ea' : 'white' }"-->
                <div *ngIf="submitted && f.valid_until.errors?.MatchDateFromUntil" class="invalid-feedback">
                  <div *ngIf="f.valid_until.errors?.MatchDateFromUntil">Data incorretta</div>
                </div>
              </div>
              <div class="col-sm-2">
                <div class="custom-control custom-checkbox">
                  <input type="checkbox" formControlName="valid_until_empty" name="valid_until_empty"
                         class="custom-control-input" id="unlimitedCheck"
                         (change)="toggleCheckbox($event)" data-md-icheck>
                  <label class="custom-control-label" for="unlimitedCheck">Illimitato</label>
                </div>
              </div>
            </div> <!-- Valid Until -->

            <div class="form-group row">
              <label class="col-sm-2 col-form-label">Vincoli:</label>
              <div class="col-sm-8">
                <input [readonly]="markedConstraints" type="text" formControlName="constraints" class="form-control"
                       [ngClass]="{ 'is-invalid': submitted && f.constraints.errors }"/>
                <div *ngIf="submitted && f.constraints.errors" class="invalid-feedback">
                  <div *ngIf="f.constraints.errors">Valore obbligatorio</div>
                </div>
              </div>
              <div class="col-sm-2">
                <div class="custom-control custom-checkbox">
                  <input type="checkbox" class="custom-control-input" id="constraintsCheck"
                         [checked]="markedConstraints" (change)="toggleCheckbox($event)" data-md-icheck>
                  <label class="custom-control-label" for="constraintsCheck">Nessuna</label>
                </div>
              </div>
            </div> <!-- Constraints -->
            <div class="form-group row">
              <label class="col-sm-2 col-form-label">Quantità</label>
              <div class="col-sm-10">
                <input type="number" formControlName="quantity" class="form-control"
                       [ngClass]="{ 'is-invalid': submitted && f.quantity.errors }"/>
                <div *ngIf="submitted && f.quantity.errors" class="invalid-feedback">
                  <div *ngIf="f.quantity.errors?.MatchErrorQuantity">Valore richiesto o incorretto</div>
                </div>
                <div class="invalid-feedback"
                     *ngIf="submitted && f.quantity.errors?.QuantityArrayCoupons">
                  <div>La quantità dei pacchetti da creare sono troppi rispetto ai coupons disponibili.</div>
                </div>
              </div>
            </div> <!-- Quantity -->

            <div class="form-group row">
              <label class="col-sm-4 col-lg-2 col-form-label">Acquisto massimo per User</label>
              <div class="col-sm-4 col-lg-8">
                <input type="number" formControlName="purchasable" class="form-control"
                       [ngClass]="{ 'is-invalid': submitted && f.purchasable.errors }"/>
                <div *ngIf="submitted && f.purchasable.errors" class="invalid-feedback">
                  <div *ngIf="f.purchasable.errors">Questo valore deve essere inferiore o uguale alla quantità creata</div>
                </div>
              </div>
              <div class="col-sm-4 col-lg-2 my-auto">
                <div class="custom-control custom-checkbox">
                  <input type="checkbox" class="custom-control-input" id="quantityCheck"
                         [checked]="markedQuantity" (change)="toggleCheckbox($event)" data-md-icheck>
                  <label class="custom-control-label" for="quantityCheck">Senza limite</label>
                </div>
              </div>
            </div> <!-- Purchasable -->

            <div class="alert alert-danger col-md-12"
                 *ngIf="submitted && f.valid_from.errors?.MatchDate">La data inserita è già trascorsa!
            </div>
            <div class="alert alert-danger col-md-12"
                 *ngIf="submitted && f.valid_until.errors?.MatchDateFromUntil">la scadenza precede l'inizio
            </div>

          <!--<div class="alert alert-danger col-md-12" *ngIf="submitted && f.image.errors?.NoPath">-->
          <!--Please upload an image before create the coupon.-->
          <!--</div>-->
          <div class="alert alert-danger col-md-12" *ngIf="submitted && f.quantity.errors?.MatchQuantity">
            Quantità non corretta.
          </div>
          <div class="form group">
            <p>
              <button class="btn btn-block btn-success">{{fromEdit ? 'Salva modifiche' : 'Crea Coupon'}}</button>
            </p>
          </div>

          </form>
        </div>
      </div>
    </div>
  </div>
</div>
